cd /opt/airflow2/dags
grep -RIl "airflow\.operators\.sensors" . | xargs -r sed -i \
's/from\s\+airflow\.operators\.sensors\s\+import\s\+ExternalTaskSensor/from airflow.sensors.external_task import ExternalTaskSensor/g'

for s in webserver scheduler worker triggerer; do
  podman exec -it airflow2_${s}_1 pip install \
    "apache-airflow-providers-ssh" \
    "apache-airflow-providers-mysql" \
    "apache-airflow-providers-http"
done


podman exec -it airflow2_webserver_1 bash -lc \
'python -m pip install --user apache-airflow-providers-ssh apache-airflow-providers-mysql apache-airflow-providers-http'


for s in webserver scheduler worker triggerer; do
  podman exec -it airflow2_${s}_1 bash -lc \
  'python -m pip install --user apache-airflow-providers-ssh apache-airflow-providers-mysql apache-airflow-providers-http'
done


grep -Rn "from[[:space:]]\+airflow\.operators\.sensors[[:space:]]\+import[[:space:]]\+ExternalTaskSensor" /opt/airflow2/dags

sed -i.bak \
's/from[[:space:]]\+airflow\.operators\.sensors[[:space:]]\+import[[:space:]]\+ExternalTaskSensor/from airflow.sensors.external_task import ExternalTaskSensor/g' \
/opt/airflow2/dags/*.py

podman-compose restart scheduler webserver


grep -RIn "conn_id" /opt/airflow2/dags | sed -E 's/.*conn_id[=: ]+["'\'']([^"'\'' ]+)["'\''].*/\1/' | sort -u

mysql -h trmq01.ny2 -u airflow_ufact -p -D ufactairflow \
  -e "SELECT conn_id, conn_type, host, schema, login, password, port, extra
      FROM connection WHERE conn_id='ssh_factapps_app01'\G"

